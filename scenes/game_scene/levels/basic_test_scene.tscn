[gd_scene load_steps=28 format=3 uid="uid://dpr6mnd7ukuya"]

[ext_resource type="Material" uid="uid://3ipinosqhxal" path="res://resources/shaders/balatro_paint_mix.tres" id="1_el8cj"]
[ext_resource type="Texture2D" uid="uid://d2a26soib85fm" path="res://assets/Artworks/Hokm tVG Main Menu Background.png" id="2_f4grl"]
[ext_resource type="Script" uid="uid://cyh0d64pfygbl" path="res://addons/maaacks_game_template/base/nodes/utilities/pause_menu_controller.gd" id="3_exaxi"]
[ext_resource type="Script" uid="uid://cypa7x3fkxgr" path="res://scripts/hokm_game_manager.gd" id="3_pyd4g"]
[ext_resource type="Script" uid="uid://cxuwke0pub027" path="res://scripts/rules_engine.gd" id="3_tmcbe"]
[ext_resource type="Script" uid="uid://bftae8jkury7d" path="res://resources/UI Elements/ui_manager.gd" id="3_wtj6l"]
[ext_resource type="Script" uid="uid://bmlwpkrav3q56" path="res://addons/maaacks_game_template/extras/scripts/win_lose_manager.gd" id="3_y85nq"]
[ext_resource type="PackedScene" uid="uid://b0x8acab1b4oe" path="res://scenes/windows/pause_menu.tscn" id="4_b2thp"]
[ext_resource type="PackedScene" uid="uid://ba11po12cvait" path="res://scenes/windows/game_won_window.tscn" id="4_bljjq"]
[ext_resource type="Texture2D" uid="uid://xwtvlh4cxojg" path="res://assets/kenney_input-prompts/Flairs/Double/flair_disabled_cross.png" id="4_d5kay"]
[ext_resource type="PackedScene" uid="uid://bx7s80d8smic4" path="res://scenes/windows/level_lost_window.tscn" id="5_bljjq"]
[ext_resource type="Script" uid="uid://dxbgl3telxva0" path="res://resources/Hand/player_hand.gd" id="5_m6rcj"]
[ext_resource type="PackedScene" uid="uid://cw2s6n4ya0dat" path="res://resources/Deck/Deck.tscn" id="5_m14oq"]
[ext_resource type="PackedScene" uid="uid://byqpo4bmpwdyh" path="res://resources/UI Elements/hokm_display_panel.tscn" id="6_f4grl"]
[ext_resource type="Texture2D" uid="uid://mdddrsbhdtq2" path="res://assets/Sprites/Cards/kenney_playing-cards-pack/PNG/Cards (medium)/card_clubs_suit.png" id="7_exaxi"]
[ext_resource type="Texture2D" uid="uid://cchmw36cn2iub" path="res://assets/Sprites/Cards/kenney_playing-cards-pack/PNG/Cards (medium)/card_hearts_suit.png" id="8_sl5y5"]
[ext_resource type="Script" uid="uid://cxwpdcfwdt3rl" path="res://scripts/tutorial_controller.gd" id="8_w5ath"]
[ext_resource type="Script" uid="uid://byyymvlmevak6" path="res://resources/UI Elements/hakem_display.gd" id="8_xf0qg"]
[ext_resource type="Texture2D" uid="uid://kbvpimiey1to" path="res://assets/Sprites/Cards/kenney_playing-cards-pack/PNG/Cards (medium)/card_spades_suit.png" id="9_m6rcj"]
[ext_resource type="Texture2D" uid="uid://dbv01i82f2ybp" path="res://assets/Sprites/Misc/Anonymous Person Icon.png" id="10_d5kay"]
[ext_resource type="Script" uid="uid://dftt5gfnf3hod" path="res://resources/Hand/ai_controller.gd" id="10_tmcbe"]
[ext_resource type="Texture2D" uid="uid://nphn56k8tao0" path="res://assets/Sprites/Cards/kenney_playing-cards-pack/PNG/Cards (medium)/card_diamonds_suit.png" id="10_xf0qg"]
[ext_resource type="PackedScene" uid="uid://m4vriaj77wh4" path="res://resources/UI Elements/score_pile/score_pile.tscn" id="14_d5kay"]
[ext_resource type="PackedScene" uid="uid://d1lgf8q000ap" path="res://resources/CardSlot/card_slot.tscn" id="14_j7cxb"]

[sub_resource type="Animation" id="Animation_onchg"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:self_modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 0)]
}

[sub_resource type="Animation" id="Animation_wtj6l"]
resource_name = "fade_in_&_out"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:self_modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.26666668, 1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1), Color(1, 1, 1, 0)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_y85nq"]
_data = {
&"RESET": SubResource("Animation_onchg"),
&"fade_in_&_out": SubResource("Animation_wtj6l")
}

[node name="BasicHokmSetup" type="Node2D"]

[node name="Background" type="TextureRect" parent="."]
z_index = -2
offset_left = -640.0
offset_top = -376.0
offset_right = 637.0
offset_bottom = 376.0
size_flags_horizontal = 0
mouse_filter = 2
texture = ExtResource("2_f4grl")
expand_mode = 1
metadata/_edit_lock_ = true

[node name="BackgroundColor" type="ColorRect" parent="."]
z_index = -2
material = ExtResource("1_el8cj")
offset_left = -640.0
offset_top = -360.0
offset_right = 640.0
offset_bottom = 360.0
mouse_filter = 2
color = Color(0.24840015, 0.24840018, 0.24840015, 1)

[node name="720x720Square" type="Panel" parent="."]
visible = false
offset_left = -360.0
offset_top = -360.0
offset_right = 360.0
offset_bottom = 360.0
mouse_filter = 2
metadata/_edit_use_anchors_ = true

[node name="Timer" type="Timer" parent="."]
wait_time = 5.0

[node name="Win Lose Manager" type="Node" parent="."]
script = ExtResource("3_y85nq")
main_menu_scene_path = "uid://dhr7kwfkmlq7o"
ending_scene_path = "uid://cegpeogqhswj3"
game_won_scene = ExtResource("4_bljjq")
game_lost_scene = ExtResource("5_bljjq")

[node name="Game Manager" type="Node" parent="." node_paths=PackedStringArray("ui_manager", "deck", "hands", "trick_slots", "rulesEngine", "score_piles")]
script = ExtResource("3_pyd4g")
ui_manager = NodePath("../UIManager")
deck = NodePath("../Deck")
hands = [NodePath("../PlayerHand"), NodePath("../EnemyHand1")]
trick_slots = [NodePath("../TableTrickSlots/TrickSlot"), NodePath("../TableTrickSlots/TrickSlot1")]
rulesEngine = NodePath("../Rule Umpire")
score_piles = [null, null]

[node name="Tutorial Overlay Button" type="Button" parent="Game Manager"]
visible = false
offset_left = 472.0
offset_top = 264.0
offset_right = 574.0
offset_bottom = 323.0
text = "Tutorial"

[node name="Rule Umpire" type="Node" parent="."]
script = ExtResource("3_tmcbe")

[node name="TutorialController" type="Node" parent="." node_paths=PackedStringArray("game_manager", "tutorial_ui")]
script = ExtResource("8_w5ath")
game_manager = NodePath("../Game Manager")
tutorial_ui = NodePath("TutorialLayer")

[node name="TutorialLayer" type="Control" parent="TutorialController"]
layout_mode = 3
anchor_left = -0.5
anchor_top = -0.5
anchor_right = 0.5
anchor_bottom = 0.5
grow_horizontal = 2
grow_vertical = 2
metadata/_edit_use_anchors_ = true

[node name="Dimmer" type="ColorRect" parent="TutorialController/TutorialLayer"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.5)

[node name="Panel" type="Panel" parent="TutorialController/TutorialLayer"]
layout_mode = 0
offset_left = 1024.0
offset_top = 167.0
offset_right = 1285.0
offset_bottom = 624.0

[node name="RichTextLabel" type="RichTextLabel" parent="TutorialController/TutorialLayer"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.80625
anchor_top = 0.24444444
anchor_right = 1.0
anchor_bottom = 0.85555553
grow_horizontal = 2
grow_vertical = 2
text = "Welcome to Hokm!
Let's learn the basics."
metadata/_edit_use_anchors_ = true

[node name="NextButton" type="Button" parent="TutorialController/TutorialLayer"]
layout_mode = 0
offset_left = 1064.0
offset_top = 544.0
offset_right = 1137.0
offset_bottom = 603.0
text = "Next"

[node name="SkipButton" type="Button" parent="TutorialController/TutorialLayer"]
layout_mode = 0
offset_left = 1168.0
offset_top = 544.0
offset_right = 1241.0
offset_bottom = 603.0
text = "Skip"

[node name="UIManager" type="Node" parent="." node_paths=PackedStringArray("hakem_display_label", "hokm_display_label", "score_display_label", "turn_indicator", "turn_prompt")]
script = ExtResource("3_wtj6l")
hakem_display_label = NodePath("HUDLayer/InfoPanel1/Hakem Display Label")
hokm_display_label = NodePath("HUDLayer/Hokm Display Label")
score_display_label = NodePath("HUDLayer/Score Label")
turn_indicator = NodePath("HUDLayer/Turn Indicator")
turn_prompt = NodePath("HUDLayer/Turn Prompt")

[node name="HUDLayer" type="CanvasLayer" parent="UIManager"]
follow_viewport_enabled = true

[node name="InfoPanel1" type="Panel" parent="UIManager/HUDLayer"]
self_modulate = Color(1, 1, 1, 0.133)
anchors_preset = -1
anchor_left = -0.5
anchor_top = -0.46666667
anchor_right = -0.3
anchor_bottom = -0.15555556
mouse_filter = 2
metadata/_edit_use_anchors_ = true

[node name="Hakem Display Label" type="Label" parent="UIManager/HUDLayer/InfoPanel1"]
visible = false
layout_mode = 1
anchors_preset = -1
anchor_left = 0.25000003
anchor_top = 0.71428573
anchor_right = 0.9375
anchor_bottom = 0.82486266
theme_override_font_sizes/font_size = 22
text = "HAKEM:"
vertical_alignment = 1
script = ExtResource("8_xf0qg")
metadata/_edit_use_anchors_ = true

[node name="TextureRect" type="TextureRect" parent="UIManager/HUDLayer/InfoPanel1/Hakem Display Label"]
visible = false
layout_mode = 1
anchors_preset = -1
anchor_left = -0.3181819
anchor_top = -0.6956522
anchor_right = -0.069316216
anchor_bottom = 1.3913044
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("4_d5kay")
expand_mode = 1

[node name="Hokm Display Label" parent="UIManager/HUDLayer" instance=ExtResource("6_f4grl")]
offset_left = -576.0
offset_top = -312.0
offset_right = -512.0
offset_bottom = -289.0

[node name="Score Label" type="Label" parent="UIManager/HUDLayer"]
anchors_preset = -1
anchor_left = -0.45
anchor_top = -0.36666667
anchor_right = -0.37421876
anchor_bottom = -0.34305555
text = "TRICKS WON:"
metadata/_edit_use_anchors_ = true

[node name="Turn Indicator" type="Label" parent="UIManager/HUDLayer"]
anchors_preset = -1
anchor_left = -0.45
anchor_top = -0.32222223
anchor_right = -0.35
anchor_bottom = -0.26666668
offset_bottom = 1.5258789e-05
text = "Player %'s Turn"
horizontal_alignment = 1
vertical_alignment = 1
metadata/_edit_use_anchors_ = true

[node name="Container" type="HBoxContainer" parent="UIManager/HUDLayer"]
anchors_preset = -1
anchor_left = -0.059375
anchor_top = 0.44444445
anchor_right = 0.05
anchor_bottom = 0.4888889
offset_left = 4.0
offset_right = 4.0
alignment = 1
metadata/_edit_use_anchors_ = true

[node name="Clubs" type="TextureButton" parent="UIManager/HUDLayer/Container"]
layout_mode = 2
texture_normal = ExtResource("7_exaxi")
stretch_mode = 0
metadata/_edit_use_anchors_ = true

[node name="Hearts" type="TextureButton" parent="UIManager/HUDLayer/Container"]
layout_mode = 2
texture_normal = ExtResource("8_sl5y5")
stretch_mode = 0
metadata/_edit_use_anchors_ = true

[node name="Spades" type="TextureButton" parent="UIManager/HUDLayer/Container"]
layout_mode = 2
texture_normal = ExtResource("9_m6rcj")
stretch_mode = 0
metadata/_edit_use_anchors_ = true

[node name="Diamonds" type="TextureButton" parent="UIManager/HUDLayer/Container"]
layout_mode = 2
texture_normal = ExtResource("10_xf0qg")
stretch_mode = 0
metadata/_edit_use_anchors_ = true

[node name="Turn Prompt" type="Label" parent="UIManager/HUDLayer"]
self_modulate = Color(1, 1, 1, 0)
offset_left = -128.0
offset_top = 64.0
offset_right = 128.0
offset_bottom = 128.0
theme_override_font_sizes/font_size = 20
text = "YOUR TURN"
horizontal_alignment = 1
vertical_alignment = 1

[node name="AnimationPlayer" type="AnimationPlayer" parent="UIManager/HUDLayer/Turn Prompt"]
libraries = {
&"": SubResource("AnimationLibrary_y85nq")
}

[node name="DebugLayer" type="CanvasLayer" parent="UIManager"]
visible = false

[node name="Console" type="TextEdit" parent="UIManager/DebugLayer"]
anchors_preset = -1
anchor_left = -0.49375
anchor_top = -0.14444445
anchor_right = -0.30625
anchor_bottom = 0.35555556
mouse_filter = 2
text = "Console"
editable = false
metadata/_edit_use_anchors_ = true

[node name="EndTurnTestBtn" type="Button" parent="UIManager/DebugLayer"]
anchors_preset = -1
anchor_left = -0.48125
anchor_top = 0.18888889
anchor_right = -0.38671875
anchor_bottom = 0.27083334
text = "End Turn"
metadata/_edit_use_anchors_ = true

[node name="ResolveTrickDebugBtn" type="Button" parent="UIManager/DebugLayer"]
anchors_preset = -1
anchor_left = -0.4875
anchor_top = 0.044444446
anchor_right = -0.3625
anchor_bottom = 0.12638889
text = "Resolve Trick"
metadata/_edit_use_anchors_ = true

[node name="LeadingSuitDebugLbl" type="Label" parent="UIManager/DebugLayer"]
anchors_preset = -1
anchor_left = -0.45
anchor_top = -0.2
anchor_right = -0.325
anchor_bottom = -0.17638889
text = "LEADING SUIT:"
metadata/_edit_use_anchors_ = true

[node name="PauseMenuController" type="Node" parent="."]
script = ExtResource("3_exaxi")
pause_menu_packed = ExtResource("4_b2thp")

[node name="Camera2D" type="Camera2D" parent="."]

[node name="Deck" parent="." instance=ExtResource("5_m14oq")]
z_index = 0
position = Vector2(-196, 1)

[node name="Discard Slot" parent="." instance=ExtResource("14_j7cxb")]
visible = false
position = Vector2(184, 1)
slot_type = 1

[node name="TableTrickSlots" type="Node" parent="."]

[node name="Table Panel" type="Panel" parent="TableTrickSlots"]
self_modulate = Color(1, 1, 1, 0.404)
z_index = -1
offset_left = -320.0
offset_top = -360.0
offset_right = 320.0
offset_bottom = 360.0
mouse_filter = 2
metadata/_edit_lock_ = true

[node name="TrickSlot" parent="TableTrickSlots" instance=ExtResource("14_j7cxb")]
z_index = -1
position = Vector2(48, 17)

[node name="TrickSlot1" parent="TableTrickSlots" instance=ExtResource("14_j7cxb")]
z_index = -1
position = Vector2(-48, -15)

[node name="PlayerHand" type="Node2D" parent="." node_paths=PackedStringArray("gameManager", "rulesEngine", "trick_slot", "HandLabel", "score_pile")]
position = Vector2(0, 193)
script = ExtResource("5_m6rcj")
hand_layout_mode = 0
gameManager = NodePath("../Game Manager")
rulesEngine = NodePath("../Rule Umpire")
trick_slot = NodePath("../TableTrickSlots/TrickSlot")
HandLabel = NodePath("PlayerLabel")
score_pile = NodePath("../Player1ScorePile")
is_player_controlled = true

[node name="HandPanel" type="Panel" parent="PlayerHand"]
visible = false
self_modulate = Color(1, 1, 1, 0.404)
offset_left = -322.0
offset_top = -56.0
offset_right = 320.0
offset_bottom = 59.0
mouse_filter = 2

[node name="PlayerIcon" type="TextureRect" parent="PlayerHand"]
offset_left = -24.0
offset_top = 31.0
offset_right = 24.0
offset_bottom = 79.0
texture = ExtResource("10_d5kay")
expand_mode = 1

[node name="PlayerLabel" type="Label" parent="PlayerHand"]
offset_left = -64.0
offset_top = 87.0
offset_right = 64.0
offset_bottom = 104.0
text = "Player 0 (You)"
horizontal_alignment = 1
metadata/_edit_use_anchors_ = true

[node name="EnemyHand1" type="Node2D" parent="." node_paths=PackedStringArray("rulesEngine", "trick_slot", "score_pile", "ai_controller")]
position = Vector2(0, -191)
script = ExtResource("5_m6rcj")
player_id = 1
rulesEngine = NodePath("../Rule Umpire")
trick_slot = NodePath("../TableTrickSlots/TrickSlot1")
score_pile = NodePath("../Enemy1ScorePile")
ai_controller = NodePath("AIController")

[node name="HandPanel" type="Panel" parent="EnemyHand1"]
visible = false
self_modulate = Color(1, 1, 1, 0.404)
offset_left = -322.0
offset_top = -53.0
offset_right = 320.0
offset_bottom = 62.0
mouse_filter = 2

[node name="PlayerIcon1" type="TextureRect" parent="EnemyHand1"]
offset_left = -24.0
offset_top = -121.0
offset_right = 24.0
offset_bottom = -73.0
texture = ExtResource("10_d5kay")
expand_mode = 1

[node name="PlayerLabel1" type="Label" parent="EnemyHand1"]
offset_left = -64.0
offset_top = -65.0
offset_right = 64.0
offset_bottom = -48.0
text = "Player 1 (AI)"
horizontal_alignment = 1

[node name="AIController" type="Node" parent="EnemyHand1" node_paths=PackedStringArray("game_manager", "rulesEngine")]
script = ExtResource("10_tmcbe")
game_manager = NodePath("../../Game Manager")
rulesEngine = NodePath("../../Rule Umpire")

[node name="AITestingBtn" type="Button" parent="EnemyHand1"]
visible = false
offset_left = -184.0
offset_top = -112.0
offset_right = -82.0
offset_bottom = -53.0
text = "Test AI"
metadata/_edit_use_anchors_ = true

[node name="Player1ScorePile" parent="." instance=ExtResource("14_d5kay")]
position = Vector2(-384, 324)

[node name="Enemy1ScorePile" parent="." instance=ExtResource("14_d5kay")]
position = Vector2(384, -280)

[node name="EnemyHand2 (Placeholder)" type="Node2D" parent="."]
visible = false
position = Vector2(448, 0)
script = ExtResource("5_m6rcj")

[node name="PlayerIcon2" type="TextureRect" parent="EnemyHand2 (Placeholder)"]
offset_left = 40.0
offset_top = -72.0
offset_right = 168.0
offset_bottom = 64.0
texture = ExtResource("10_d5kay")
expand_mode = 1

[node name="PlayerLabel2" type="Label" parent="EnemyHand2 (Placeholder)"]
offset_left = 40.0
offset_top = -72.0
offset_right = 168.0
offset_bottom = -55.0
theme_override_colors/font_color = Color(0, 0, 0, 1)
text = "Player 2 (AI)"
horizontal_alignment = 1

[node name="AIController" type="Node" parent="EnemyHand2 (Placeholder)" node_paths=PackedStringArray("rulesEngine")]
script = ExtResource("10_tmcbe")
rulesEngine = NodePath("../../Rule Umpire")

[node name="EnemyHand3 (Placeholder)" type="Node2D" parent="."]
visible = false
position = Vector2(-320, 0)
script = ExtResource("5_m6rcj")

[node name="PlayerIcon3" type="TextureRect" parent="EnemyHand3 (Placeholder)"]
offset_top = -64.0
offset_right = 128.0
offset_bottom = 72.0
texture = ExtResource("10_d5kay")
expand_mode = 1

[node name="PlayerLabel3" type="Label" parent="EnemyHand3 (Placeholder)"]
offset_left = 16.0
offset_top = -64.0
offset_right = 115.0
offset_bottom = -47.0
text = "Player 4 (AI)"
metadata/_edit_use_anchors_ = true

[node name="AIController" type="Node" parent="EnemyHand3 (Placeholder)"]
script = ExtResource("10_tmcbe")

[connection signal="round_ended" from="Game Manager" to="UIManager" method="_on_game_manager_round_ended"]
[connection signal="trick_resolved" from="Game Manager" to="UIManager" method="_on_game_manager_trick_resolved"]
[connection signal="turn_started" from="Game Manager" to="UIManager" method="_on_game_manager_turn_started"]
[connection signal="card_drawn" from="Deck" to="Game Manager" method="_on_card_drawn"]
[connection signal="pressed" from="EnemyHand1/AITestingBtn" to="EnemyHand1/AIController" method="_on_ai_testing_btn_pressed"]

[editable path="Player1ScorePile"]
[editable path="Enemy1ScorePile"]
